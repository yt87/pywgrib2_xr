

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pywgrib2_xr.grids &mdash; pywgrib2_xr 0.2.2-rc0+15.ge499aed documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> pywgrib2_xr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installing.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../inventory.html">Inventory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../template.html">Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reading.html">Reading GRIB2 files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plotting.html">Plotting Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remapping.html">Remapping Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../memory-buffers.html">Memory Buffers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging-and-exceptions.html">Logging and Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../writing-grib-files.html">Writing GRIB2 Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance.html">Performance</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../whats-new.html">Whatâ€™s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pywgrib2.html">Script pywgrib2</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pywgrib2_xr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pywgrib2_xr.grids</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pywgrib2_xr.grids</h1><div class="highlight"><pre>
<span></span><span class="c1"># from __future__ import annotations  # Python-3.7+</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># type: ignore</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">ArrayLike</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ArrayLike</span> <span class="o">=</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_Variable</span>
<span class="kn">from</span> <span class="nn">.wgrib2</span> <span class="kn">import</span> <span class="n">latlon</span><span class="p">,</span> <span class="n">latlon2xy</span>


<span class="k">class</span> <span class="nc">GDTNum</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid Definition Template Number.&quot;&quot;&quot;</span>

    <span class="n">UNDEFINED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="s2">&quot;Not set&quot;</span>
    <span class="n">LATLON</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="s2">&quot;Latitude/Longitude&quot;</span>
    <span class="n">ROT_LATLON</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="s2">&quot;Rotated latitude/longitude&quot;</span>
    <span class="n">MERCATOR</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="s2">&quot;Mercator&quot;</span>
    <span class="n">POLAR_STEREO</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="s2">&quot;Polar stereographic&quot;</span>
    <span class="n">LAMBERT_CONFORMAL</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="s2">&quot;Lambert conformal&quot;</span>
    <span class="n">GAUSSIAN</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="s2">&quot;Global Gaussian&quot;</span>
    <span class="n">SPACE_VIEW</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="s2">&quot;Space View&quot;</span>


<span class="k">def</span> <span class="nf">_norm_lon</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">-=</span> <span class="mi">360</span>
    <span class="k">while</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="mi">360</span>
    <span class="k">return</span> <span class="n">a</span>


<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../../generated/pywgrib2_xr.Point.html#pywgrib2_xr.Point">[docs]</a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unstructured list of points.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;points&quot;</span>

<div class="viewcode-block" id="Point.__init__"><a class="viewcode-back" href="../../generated/pywgrib2_xr.Point.html#pywgrib2_xr.Point.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">longitude</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">latitude</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">coord</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span> <span class="o">==</span> <span class="n">npts</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">)),</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;point number&quot;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">npts</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
            <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">}</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">({</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_Variable</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span></div>


<div class="viewcode-block" id="Grid"><a class="viewcode-back" href="../../generated/pywgrib2_xr.Grid.html#pywgrib2_xr.Grid">[docs]</a><span class="k">class</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2-dimensional rectangular grid.</span>

<span class="sd">    This is a base class, concrete subclasses are:</span>

<span class="sd">    * GridLatLon (0): Latitude/Longitude.</span>
<span class="sd">    * GridRotLatLon (1): Rotated Latitude/Longitude.</span>
<span class="sd">    * GridMercator (10): Mercator.</span>
<span class="sd">    * GridPolarStereo (20): Polar Stereographic Projection (can be North or South).</span>
<span class="sd">    * GridLambertConformal (30): Lambert Conformal, can be Secant, Tangent, Conical, or Bipolar</span>
<span class="sd">    * GridGaussian (40): Gaussian Latitude/Longitude.</span>
<span class="sd">    * GridSpaceView (90): Space View.</span>

<span class="sd">    These classes should not be instantiated directly, use factory methods</span>
<span class="sd">    :py:func:`grid_fromgdt`, :py:func:`grid_fromstring` and :py:func:`grid_fromdict`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="s2">&quot;Class name&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">UNDEFINED</span>
    <span class="s2">&quot;Grid definition template number&quot;</span>
    <span class="n">_sec3_head_fmt</span> <span class="o">=</span> <span class="s2">&quot;&gt;IBBIBBHBBIBIBI&quot;</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># specific to projection</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Grid.__init__"><a class="viewcode-back" href="../../generated/pywgrib2_xr.Grid.html#pywgrib2_xr.Grid.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdtmpl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">sec3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mksec3</span><span class="p">(</span><span class="n">gdtmpl</span><span class="p">)</span>
        <span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span> <span class="o">=</span> <span class="n">latlon</span><span class="p">(</span><span class="n">sec3</span><span class="p">,</span> <span class="n">npts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wesn_gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_wesn</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;GRIB_gdtnum&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtnum</span><span class="p">,</span>
            <span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">:</span> <span class="n">wesn_gdtmpl</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_params</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_globe</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_coords</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_mksec3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdtmpl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sec3_head_fmt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sec3_param_fmt</span>
        <span class="n">seclen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sec3_len</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">gds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtnum</span><span class="p">],</span> <span class="n">gdtmpl</span><span class="p">])</span>
        <span class="n">ugds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">gds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gds</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mh">0x7FFFFFFF</span>
            <span class="c1"># -1 might be missing value</span>
            <span class="n">ugds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mh">0x80000000</span> <span class="o">-</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">seclen</span><span class="p">,</span> <span class="o">*</span><span class="n">ugds</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">({</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">})</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">gdtnum</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">gdtnum</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">gdtmpl</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">decode_globe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">code</span><span class="p">,</span> <span class="n">sradius</span><span class="p">,</span> <span class="n">vradius</span><span class="p">,</span> <span class="n">smajor</span><span class="p">,</span> <span class="n">vmajor</span><span class="p">,</span> <span class="n">sminor</span><span class="p">,</span> <span class="n">vminor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="s2">&quot;earth_radius&quot;</span><span class="p">:</span> <span class="mf">6367470.0</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">vradius</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">sradius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="s2">&quot;earth_radius&quot;</span><span class="p">:</span> <span class="n">radius</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;ellipsoid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;semi_major_axis&quot;</span><span class="p">:</span> <span class="mf">6378160.0</span><span class="p">,</span>
                <span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">:</span> <span class="mf">6356775.0</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">0</span>  <span class="c1"># return value in [m]</span>
            <span class="n">major</span> <span class="o">=</span> <span class="n">vmajor</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">smajor</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">minor</span> <span class="o">=</span> <span class="n">vminor</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">sminor</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;ellipsoid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;semi_major_axis&quot;</span><span class="p">:</span> <span class="n">major</span><span class="p">,</span>
                <span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">:</span> <span class="n">minor</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;GRS80&quot;</span><span class="p">,</span>
                <span class="s2">&quot;semi_major_axis&quot;</span><span class="p">:</span> <span class="mf">6378137.0</span><span class="p">,</span>
                <span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">:</span> <span class="mf">6356752.140</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;WGS84&quot;</span><span class="p">,</span>
                <span class="s2">&quot;semi_major_axis&quot;</span><span class="p">:</span> <span class="mf">6378137.0</span><span class="p">,</span>
                <span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">:</span> <span class="mf">6356752.245</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="s2">&quot;earth_radius&quot;</span><span class="p">:</span> <span class="mf">6371229.0</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;sphere&quot;</span><span class="p">,</span> <span class="s2">&quot;earth_radius&quot;</span><span class="p">:</span> <span class="mf">6371200.0</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="s2">&quot;Airy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;semi_major_axis&quot;</span><span class="p">:</span> <span class="mf">6377563.396</span><span class="p">,</span>
                <span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">:</span> <span class="mf">6356256.909</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_globe</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mh">0xFF</span>
        <span class="n">vradius</span> <span class="o">=</span> <span class="n">vmajor</span> <span class="o">=</span> <span class="n">vminor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># 0xFFFFFFFF</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">vradius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;earth_radius&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">vmajor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;semi_major_axis&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">vminor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">code</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">vradius</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">vmajor</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">vminor</span><span class="p">]</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_Variable</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parameters for cartopy coordinate reference system.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Grid dimension names.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">globe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parameters for cartopy globe&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;GRIB parameters as dictionary&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Grid shape.&quot;&quot;&quot;</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span>

    <span class="k">def</span> <span class="nf">set_winds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">winds</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sets vector orientation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">winds</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;earth&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_winds&quot;</span><span class="p">]:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_respos</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x08</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_respos</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xF7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_winds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">winds</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wind orientation must be &#39;grid&#39; or &#39;earth&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromdict</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;earth&quot;</span><span class="p">,</span>
        <span class="n">globe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Grid&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Creates Grid Definition class from keywords.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">globe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>  <span class="c1"># NCEP model default</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">encode_globe</span><span class="p">(</span><span class="o">**</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># make prefix GRIB_optional</span>
        <span class="c1"># Replace with method removeprefix in Python-3.9</span>
        <span class="k">def</span> <span class="nf">_removeprefix</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="p">:]</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">_removeprefix</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;GRIB_&quot;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">gdtmpl</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="o">=</span><span class="n">winds</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">gdtmpl</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">globe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Grid&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Creates Grid Definition class from wgrib2 style strings.&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">,</span> <span class="n">winds</span><span class="o">=</span><span class="n">winds</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">GridLatLon</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for latitude-longitude (also known as Plate Carree) projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;latitude_longitude&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">LATLON</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIIIBIIIIB&quot;</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">72</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="n">Ni</span><span class="p">,</span> <span class="n">Nj</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">La2</span><span class="p">,</span> <span class="n">Lo2</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">Dj</span><span class="p">,</span> <span class="n">scan</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">ba</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Ni</span> <span class="o">*</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ni&quot;</span><span class="p">:</span> <span class="n">Ni</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nj&quot;</span><span class="p">:</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La1&quot;</span><span class="p">:</span> <span class="n">La1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">:</span> <span class="n">Lo1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La2&quot;</span><span class="p">:</span> <span class="n">La2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo2&quot;</span><span class="p">:</span> <span class="n">Lo2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_winds&quot;</span><span class="p">:</span> <span class="s2">&quot;earth&quot;</span> <span class="k">if</span> <span class="n">res</span> <span class="o">&amp;</span> <span class="mh">0x08</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Di&quot;</span><span class="p">:</span> <span class="n">Di</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dj&quot;</span><span class="p">:</span> <span class="n">Dj</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">ba</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basic_angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sba</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subdiv_basic_angle&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 0xFFFFFFFF)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basic_angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
        <span class="n">La1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Lo1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="c1"># Override coordinates of the last point, if present, for consistency</span>
        <span class="c1"># FIXME: make it conditional, key on La2 or Dj, only one need to be present.</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
        <span class="n">La2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Lo2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Dj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Ni</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span>
        <span class="n">Nj</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Ni</span><span class="p">,</span> <span class="n">Nj</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">La2</span><span class="p">,</span> <span class="n">Lo2</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">Dj</span><span class="p">,</span> <span class="n">scan</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;longitude&quot;</span><span class="p">,),</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;latitude&quot;</span><span class="p">,),</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
            <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">ba</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridRotLatLon</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for rotated latitude-longitude projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;rotated_latitude_longitude&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">ROT_LATLON</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIIIBIIIIBIII&quot;</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">84</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="p">(</span>
            <span class="n">Ni</span><span class="p">,</span>
            <span class="n">Nj</span><span class="p">,</span>
            <span class="n">ba</span><span class="p">,</span>
            <span class="n">sba</span><span class="p">,</span>
            <span class="n">La1</span><span class="p">,</span>
            <span class="n">Lo1</span><span class="p">,</span>
            <span class="n">res</span><span class="p">,</span>
            <span class="n">La2</span><span class="p">,</span>
            <span class="n">Lo2</span><span class="p">,</span>
            <span class="n">Di</span><span class="p">,</span>
            <span class="n">Dj</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">LaSP</span><span class="p">,</span>
            <span class="n">LoSP</span><span class="p">,</span>
            <span class="n">Rot</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">ba</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Ni</span> <span class="o">*</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ni&quot;</span><span class="p">:</span> <span class="n">Ni</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nj&quot;</span><span class="p">:</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La1&quot;</span><span class="p">:</span> <span class="n">La1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">:</span> <span class="n">Lo1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La2&quot;</span><span class="p">:</span> <span class="n">La2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo2&quot;</span><span class="p">:</span> <span class="n">Lo2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_winds&quot;</span><span class="p">:</span> <span class="s2">&quot;earth&quot;</span> <span class="k">if</span> <span class="n">res</span> <span class="o">&amp;</span> <span class="mh">0x08</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Di&quot;</span><span class="p">:</span> <span class="n">Di</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dj&quot;</span><span class="p">:</span> <span class="n">Dj</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LaSP&quot;</span><span class="p">:</span> <span class="n">LaSP</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LoSP&quot;</span><span class="p">:</span> <span class="n">LoSP</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Rot&quot;</span><span class="p">:</span> <span class="n">Rot</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">ba</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basic_angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sba</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subdiv_basic_angle&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 0xFFFFFFFF</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basic_angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
        <span class="n">La1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Lo1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="c1"># Override coordinates of the last point, if present, for consistency</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">])</span> <span class="o">%</span> <span class="mi">360</span>
        <span class="n">La2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Lo2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Dj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Ni</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span>
        <span class="n">Nj</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="n">LaSP</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaSP&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">LoSP</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LoSP&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Rot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Rot&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Ni</span><span class="p">,</span>
            <span class="n">Nj</span><span class="p">,</span>
            <span class="n">ba</span><span class="p">,</span>
            <span class="n">sba</span><span class="p">,</span>
            <span class="n">La1</span><span class="p">,</span>
            <span class="n">Lo1</span><span class="p">,</span>
            <span class="n">res</span><span class="p">,</span>
            <span class="n">La2</span><span class="p">,</span>
            <span class="n">Lo2</span><span class="p">,</span>
            <span class="n">Di</span><span class="p">,</span>
            <span class="n">Dj</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">LaSP</span><span class="p">,</span>
            <span class="n">LoSP</span><span class="p">,</span>
            <span class="n">Rot</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># rot-ll:sp_lon:sp_lat:sp_rot lon0:nlon:dlon lat0:nlat:dlat</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LoSP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaSP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Rot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Lo2&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Ni&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">x_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_x_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_La1&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_La2&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Nj&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">y_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_y_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;x&quot;</span><span class="p">,),</span> <span class="n">x</span><span class="p">,</span> <span class="n">x_attrs</span><span class="p">),</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;y&quot;</span><span class="p">,),</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_attrs</span><span class="p">),</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
            <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">ba</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">,</span>
            <span class="s2">&quot;pole_longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoSP&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pole_latitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_LaSP&quot;</span><span class="p">],</span>
            <span class="s2">&quot;central_rotated_longitude&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_Rot&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridMercator</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for Mercator projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;mercator&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">MERCATOR</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIBIIIBIII&quot;</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">72</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">15</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="n">Ni</span><span class="p">,</span> <span class="n">Nj</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">LaD</span><span class="p">,</span> <span class="n">La2</span><span class="p">,</span> <span class="n">Lo2</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">orient</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">Dj</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="k">assert</span> <span class="n">orient</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Ni</span> <span class="o">*</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ni&quot;</span><span class="p">:</span> <span class="n">Ni</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nj&quot;</span><span class="p">:</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La1&quot;</span><span class="p">:</span> <span class="n">La1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">:</span> <span class="n">Lo1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La2&quot;</span><span class="p">:</span> <span class="n">La2</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo2&quot;</span><span class="p">:</span> <span class="n">Lo2</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LaD&quot;</span><span class="p">:</span> <span class="n">LaD</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_winds&quot;</span><span class="p">:</span> <span class="s2">&quot;earth&quot;</span> <span class="k">if</span> <span class="n">res</span> <span class="o">&amp;</span> <span class="mh">0x08</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Di&quot;</span><span class="p">:</span> <span class="n">Di</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dj&quot;</span><span class="p">:</span> <span class="n">Dj</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">La1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Lo1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">La2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Lo2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">LaD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Dj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Ni</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span>
        <span class="n">Nj</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Ni</span><span class="p">,</span> <span class="n">Nj</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">LaD</span><span class="p">,</span> <span class="n">La2</span><span class="p">,</span> <span class="n">Lo2</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">Dj</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># FIXME: add x/y coordinates</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;longitude&quot;</span><span class="p">,),</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;latitude&quot;</span><span class="p">,),</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">,</span>
            <span class="s2">&quot;standard_parallel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_LaD&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridPolarStereo</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for Polar Stereographic (North and South) projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;polar_stereographic&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">POLAR_STEREO</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIBIIIIBB&quot;</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">65</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">17</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">LaD</span><span class="p">,</span> <span class="n">LoV</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">proj_centre</span><span class="p">,</span> <span class="n">scan</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nx&quot;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ny&quot;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La1&quot;</span><span class="p">:</span> <span class="n">La1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">:</span> <span class="n">Lo1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LaD&quot;</span><span class="p">:</span> <span class="n">LaD</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">:</span> <span class="n">LoV</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_winds&quot;</span><span class="p">:</span> <span class="s2">&quot;earth&quot;</span> <span class="k">if</span> <span class="n">res</span> <span class="o">&amp;</span> <span class="mh">0x08</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dx&quot;</span><span class="p">:</span> <span class="n">Dx</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dy&quot;</span><span class="p">:</span> <span class="n">Dy</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LaO&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">90.0</span> <span class="k">if</span> <span class="n">proj_centre</span> <span class="o">&amp;</span> <span class="mh">0x80</span> <span class="k">else</span> <span class="mf">90.0</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">La1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Lo1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">LaD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">LoV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LoV&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Dx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dx&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nx&quot;</span><span class="p">]</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ny&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="n">proj_centre</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mh">0x00</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">LaD</span><span class="p">,</span> <span class="n">LoV</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">proj_centre</span><span class="p">,</span> <span class="n">scan</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.0</span> <span class="k">if</span> <span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;nps&quot;</span> <span class="k">else</span> <span class="o">-</span><span class="mf">90.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LoV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ny&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lat_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_LaO&quot;</span><span class="p">]</span>
        <span class="n">lon_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">]</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span> <span class="o">=</span> <span class="n">latlon2xy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mksec3</span><span class="p">(</span><span class="n">gdtmpl</span><span class="p">),</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">lon_o</span><span class="p">,</span> <span class="n">lat_o</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_Dx&quot;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_Dy&quot;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_Nx&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="n">x_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_x_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_Ny&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">yo</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="n">y_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_y_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;x&quot;</span><span class="p">,),</span> <span class="n">x</span><span class="p">,</span> <span class="n">x_attrs</span><span class="p">),</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;y&quot;</span><span class="p">,),</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">,</span>
            <span class="s2">&quot;straight_vertical_longitude_from_pole&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">],</span>
            <span class="s2">&quot;standard_parallel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_LaD&quot;</span><span class="p">],</span>
            <span class="s2">&quot;latitude_of_projection_origin&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;GRIB_LaO&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridLambertConformal</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for Lambert conformal projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;lambert_conformal_conic&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">LAMBERT_CONFORMAL</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIBIIIIBBIIII&quot;</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">81</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">17</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="p">(</span>
            <span class="n">Nx</span><span class="p">,</span>
            <span class="n">Ny</span><span class="p">,</span>
            <span class="n">La1</span><span class="p">,</span>
            <span class="n">Lo1</span><span class="p">,</span>
            <span class="n">res</span><span class="p">,</span>
            <span class="n">LaD</span><span class="p">,</span>
            <span class="n">LoV</span><span class="p">,</span>
            <span class="n">Dx</span><span class="p">,</span>
            <span class="n">Dy</span><span class="p">,</span>
            <span class="n">proj_centre</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">Latin1</span><span class="p">,</span>
            <span class="n">Latin2</span><span class="p">,</span>
            <span class="n">LaSP</span><span class="p">,</span>
            <span class="n">LoSP</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nx&quot;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ny&quot;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La1&quot;</span><span class="p">:</span> <span class="n">La1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">:</span> <span class="n">Lo1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LaD&quot;</span><span class="p">:</span> <span class="n">LaD</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">:</span> <span class="n">LoV</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_winds&quot;</span><span class="p">:</span> <span class="s2">&quot;earth&quot;</span> <span class="k">if</span> <span class="n">res</span> <span class="o">&amp;</span> <span class="mh">0x08</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dx&quot;</span><span class="p">:</span> <span class="n">Dx</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dy&quot;</span><span class="p">:</span> <span class="n">Dy</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Latin1&quot;</span><span class="p">:</span> <span class="n">Latin1</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Latin2&quot;</span><span class="p">:</span> <span class="n">Latin2</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LaSP&quot;</span><span class="p">:</span> <span class="n">LaSP</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_LoSP&quot;</span><span class="p">:</span> <span class="n">LoSP</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">La1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Lo1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">LaD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">LoV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;LoV&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Latin1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Latin2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">proj_centre</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin2&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="mh">0x00</span>
        <span class="n">la_sp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.0</span> <span class="k">if</span> <span class="n">proj_centre</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">90.0</span>
        <span class="n">LaSP</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LaSP&quot;</span><span class="p">,</span> <span class="n">la_sp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">LoSP</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LoSP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Dx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dx&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nx&quot;</span><span class="p">]</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ny&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Nx</span><span class="p">,</span>
            <span class="n">Ny</span><span class="p">,</span>
            <span class="n">La1</span><span class="p">,</span>
            <span class="n">Lo1</span><span class="p">,</span>
            <span class="n">res</span><span class="p">,</span>
            <span class="n">LaD</span><span class="p">,</span>
            <span class="n">LoV</span><span class="p">,</span>
            <span class="n">Dx</span><span class="p">,</span>
            <span class="n">Dy</span><span class="p">,</span>
            <span class="n">proj_centre</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">Latin1</span><span class="p">,</span>
            <span class="n">Latin2</span><span class="p">,</span>
            <span class="n">LaSP</span><span class="p">,</span>
            <span class="n">LoSP</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LoV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin1&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;LaD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Latin2&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ny&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lat_o</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Latin1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Latin2&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">lon_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">]</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span> <span class="o">=</span> <span class="n">latlon2xy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mksec3</span><span class="p">(</span><span class="n">gdtmpl</span><span class="p">),</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">lon_o</span><span class="p">,</span> <span class="n">lat_o</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Dx&quot;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Dy&quot;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Nx&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="n">x_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_x_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Ny&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">yo</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="n">y_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_y_coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;x&quot;</span><span class="p">,),</span> <span class="n">x</span><span class="p">,</span> <span class="n">x_attrs</span><span class="p">),</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;y&quot;</span><span class="p">,),</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">lat_origin</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Latin1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Latin2&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">,</span>
            <span class="s2">&quot;longitude_of_central_meridian&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">],</span>
            <span class="s2">&quot;standard_parallels&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_LoV&quot;</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="s2">&quot;latitude_of_projection_origin&quot;</span><span class="p">:</span> <span class="n">lat_origin</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridGaussian</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for Global Gaussian projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">GAUSSIAN</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIIIBIIIIB&quot;</span>
    <span class="n">_sec3_len</span> <span class="o">=</span> <span class="mi">72</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="n">Ni</span><span class="p">,</span> <span class="n">Nj</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">La2</span><span class="p">,</span> <span class="n">Lo2</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">scan</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">ba</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Ni</span> <span class="o">*</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ni&quot;</span><span class="p">:</span> <span class="n">Ni</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nj&quot;</span><span class="p">:</span> <span class="n">Nj</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La1&quot;</span><span class="p">:</span> <span class="n">La1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo1&quot;</span><span class="p">:</span> <span class="n">Lo1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_La2&quot;</span><span class="p">:</span> <span class="n">La2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lo2&quot;</span><span class="p">:</span> <span class="n">Lo2</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_winds&quot;</span><span class="p">:</span> <span class="s2">&quot;earth&quot;</span> <span class="k">if</span> <span class="n">res</span> <span class="o">&amp;</span> <span class="mh">0x08</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Di&quot;</span><span class="p">:</span> <span class="n">Di</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_N&quot;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">ba</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basic_angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sba</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subdiv_basic_angle&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 0xFFFFFFFF)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basic_angle&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
        <span class="n">Ni</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span>
        <span class="n">Nj</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span>
        <span class="n">La1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Lo1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">La2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;La2&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">lo2</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ni</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span>
        <span class="n">Lo2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Lo2&quot;</span><span class="p">,</span> <span class="n">lo2</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">Di</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Nj</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Ni</span><span class="p">,</span> <span class="n">Nj</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span><span class="p">,</span> <span class="n">La1</span><span class="p">,</span> <span class="n">Lo1</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">La2</span><span class="p">,</span> <span class="n">Lo2</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">scan</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lo1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ni&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Di&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tok</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;La1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tok</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;longitude&quot;</span><span class="p">,),</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;latitude&quot;</span><span class="p">,),</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
            <span class="n">ba</span><span class="p">,</span> <span class="n">sba</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="k">if</span> <span class="n">ba</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ba</span> <span class="o">/</span> <span class="n">sba</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridSpaceView</span><span class="p">(</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grid definition for Space View projection.&quot;&quot;&quot;</span>

    <span class="n">cfname</span> <span class="o">=</span> <span class="s2">&quot;space_view&quot;</span>
    <span class="n">gdtnum</span> <span class="o">=</span> <span class="n">GDTNum</span><span class="o">.</span><span class="n">SPACE_VIEW</span>
    <span class="n">_sec3_param_fmt</span> <span class="o">=</span> <span class="s2">&quot;IIIIBIIIIBIIII&quot;</span>
    <span class="n">_respos</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">_scanpos</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_params</span><span class="p">(</span><span class="n">winds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nx&quot;</span><span class="p">]</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Ny&quot;</span><span class="p">]</span>
        <span class="n">Dx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dx&quot;</span><span class="p">]</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;Dy&quot;</span><span class="p">]</span>
        <span class="n">Xp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Xp&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Yp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Yp&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Nr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Nr&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="n">Lap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lap&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Lop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Lop&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">OriAngle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;OriAngle&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">Xo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Xo&quot;</span><span class="p">])</span>
        <span class="n">Yo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Yo&quot;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="k">if</span> <span class="n">winds</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span> <span class="k">else</span> <span class="mh">0x30</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Lap</span><span class="p">,</span> <span class="n">Lop</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">Dx</span><span class="p">,</span> <span class="n">Dy</span><span class="p">,</span> <span class="n">Xp</span><span class="p">,</span> <span class="n">Yp</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">OriAngle</span><span class="p">,</span> <span class="n">Nr</span><span class="p">,</span> <span class="n">Xo</span><span class="p">,</span> <span class="n">Yo</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">decode_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_gdtmpl&quot;</span><span class="p">]</span>
        <span class="p">(</span>
            <span class="n">Nx</span><span class="p">,</span>
            <span class="n">Ny</span><span class="p">,</span>
            <span class="n">Lap</span><span class="p">,</span>
            <span class="n">Lop</span><span class="p">,</span>
            <span class="n">res</span><span class="p">,</span>
            <span class="n">Dx</span><span class="p">,</span>
            <span class="n">Dy</span><span class="p">,</span>
            <span class="n">Xp</span><span class="p">,</span>
            <span class="n">Yp</span><span class="p">,</span>
            <span class="n">scan</span><span class="p">,</span>
            <span class="n">OriAngle</span><span class="p">,</span>
            <span class="n">Nr</span><span class="p">,</span>
            <span class="n">Xo</span><span class="p">,</span>
            <span class="n">Yo</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;GRIB_Npts&quot;</span><span class="p">:</span> <span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nx&quot;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Ny&quot;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lap&quot;</span><span class="p">:</span> <span class="n">Lap</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Lop&quot;</span><span class="p">:</span> <span class="n">Lop</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dx&quot;</span><span class="p">:</span> <span class="n">Dx</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Dy&quot;</span><span class="p">:</span> <span class="n">Dy</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Xp&quot;</span><span class="p">:</span> <span class="n">Xp</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Yp&quot;</span><span class="p">:</span> <span class="n">Yp</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_OriAngle&quot;</span><span class="p">:</span> <span class="n">OriAngle</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Nr&quot;</span><span class="p">:</span> <span class="n">Nr</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Xo&quot;</span><span class="p">:</span> <span class="n">Xo</span><span class="p">,</span>
                <span class="s2">&quot;GRIB_Yo&quot;</span><span class="p">:</span> <span class="n">Yo</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">strings2params</span><span class="p">(</span><span class="n">strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sphere&quot;</span><span class="p">:</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span><span class="p">[</span><span class="s2">&quot;earth_radius&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span><span class="p">[</span><span class="s2">&quot;semi_major_axis&quot;</span><span class="p">]</span>
            <span class="n">ry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globe</span><span class="p">[</span><span class="s2">&quot;semi_minor_axis&quot;</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Nr&quot;</span><span class="p">]</span>
        <span class="n">a_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">rx</span> <span class="o">/</span> <span class="p">(</span><span class="n">rx</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">a_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">ry</span> <span class="o">/</span> <span class="p">(</span><span class="n">ry</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Dx&quot;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Dy&quot;</span><span class="p">]</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Xp&quot;</span><span class="p">]</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Yp&quot;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a_x</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Nx&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">xp</span><span class="p">))</span>
        <span class="n">x_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_x_coordinate&quot;</span><span class="p">}</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a_y</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;GRIB_Ny&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">yp</span><span class="p">))</span>
        <span class="n">y_attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;projection_y_coordinate&quot;</span><span class="p">}</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lon_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_east&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">lat_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude coordinate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;degree_north&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_name&quot;</span><span class="p">:</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;x&quot;</span><span class="p">,),</span> <span class="n">x</span><span class="p">,</span> <span class="n">x_attrs</span><span class="p">),</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">((</span><span class="s2">&quot;y&quot;</span><span class="p">,),</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_attrs</span><span class="p">),</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon_attrs</span><span class="p">),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">_Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat_attrs</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_wesn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">latitude</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">gdtmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdtmpl</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">:</span>
            <span class="n">gdtmpl</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpos</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span>
        <span class="k">return</span> <span class="n">gdtmpl</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;grid_mapping_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfname</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="grid_fromgds"><a class="viewcode-back" href="../../generated/pywgrib2_xr.grid_fromgds.html#pywgrib2_xr.grid_fromgds">[docs]</a><span class="k">def</span> <span class="nf">grid_fromgds</span><span class="p">(</span><span class="n">gdtnum</span><span class="p">,</span> <span class="n">gdtmpl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory method to create projection from grid definition section.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gdtnum: int</span>
<span class="sd">        Grid definition template number: table 3.1</span>
<span class="sd">    gdtmpl: array_like</span>
<span class="sd">        Grid definition template obtained from wgrib2 -pyinv.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Grid</span>
<span class="sd">        Projection specific class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">LATLON</span><span class="p">:</span> <span class="n">GridLatLon</span><span class="p">,</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">ROT_LATLON</span><span class="p">:</span> <span class="n">GridRotLatLon</span><span class="p">,</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">MERCATOR</span><span class="p">:</span> <span class="n">GridMercator</span><span class="p">,</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">POLAR_STEREO</span><span class="p">:</span> <span class="n">GridPolarStereo</span><span class="p">,</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">LAMBERT_CONFORMAL</span><span class="p">:</span> <span class="n">GridLambertConformal</span><span class="p">,</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">GAUSSIAN</span><span class="p">:</span> <span class="n">GridGaussian</span><span class="p">,</span>
        <span class="n">GDTNum</span><span class="o">.</span><span class="n">SPACE_VIEW</span><span class="p">:</span> <span class="n">GridSpaceView</span><span class="p">,</span>
    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">gdtnum</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid or unsupported projection: </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gdtnum</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">gdtmpl</span><span class="p">)</span></div>


<div class="viewcode-block" id="grid_fromdict"><a class="viewcode-back" href="../../generated/pywgrib2_xr.grid_fromdict.html#pywgrib2_xr.grid_fromdict">[docs]</a><span class="k">def</span> <span class="nf">grid_fromdict</span><span class="p">(</span><span class="n">projname</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory method to create projection from dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    projname: str</span>
<span class="sd">        Projection name, one of {&#39;latitude_longitude&#39;, &#39;rotated_latitude_longitude&#39;,</span>
<span class="sd">        &#39;mercator&#39;, &#39;polar_stereographic&#39;, &#39;lambert_conformal&#39;, &#39;gaussian&#39;,</span>
<span class="sd">        &#39;space_view&#39;}.</span>
<span class="sd">    globe: dict</span>
<span class="sd">        Mapping: code -&gt; int, &#39;shape&#39; -&gt; str, &#39;earth_radius&#39; -&gt; float,</span>
<span class="sd">        &#39;semi_major_axis&#39; -&gt; float, &#39;semi_minor_axis&#39; -&gt; float</span>
<span class="sd">    **kwargs:</span>
<span class="sd">        Projection-specific parameters.</span>

<span class="sd">        - latitude_longitude:</span>

<span class="sd">            - La1 : latitude of first grid point</span>
<span class="sd">            - Lo1 : longitude of first grid point</span>
<span class="sd">            - Ni : number of points along a parallel</span>
<span class="sd">            - Nj : number of points along a meridan</span>
<span class="sd">            - Di : i direction increment (deg)</span>
<span class="sd">            - Dj : j direction increment (deg)</span>

<span class="sd">        - rotated latitude_longitude:</span>

<span class="sd">            - La1 : latitude of first grid point</span>
<span class="sd">            - Lo1 : longitude of first grid point</span>
<span class="sd">            - Ni : number of points along a parallel</span>
<span class="sd">            - Nj : number of points along a meridan</span>
<span class="sd">            - Di : i direction increment (deg)</span>
<span class="sd">            - Dj : j direction increment (deg)</span>
<span class="sd">            - LaSP : latitude of the southern pole of projection</span>
<span class="sd">            - LoSP : longitude of the southern pole of projection</span>
<span class="sd">            - Rot : angle of rotation of projection</span>

<span class="sd">         - mercator:</span>

<span class="sd">            - La1 : latitude of first grid point</span>
<span class="sd">            - Lo1 : longitude of first grid point</span>
<span class="sd">            - La2 : latitude of last grid point</span>
<span class="sd">            - Lo2 : longitude of last grid point</span>
<span class="sd">            - LaD : latitude  where Di and Dj are specified</span>
<span class="sd">            - Ni : number of points along a parallel</span>
<span class="sd">            - Nj : number of points along a meridian</span>
<span class="sd">            - Di : longitudinal direction grid length</span>
<span class="sd">            - Dj : latitudinal direction grid length</span>

<span class="sd">       wgrib2/Sec1.c  - polar_stereographic:</span>

<span class="sd">            - La1 : latitude of first grid point</span>
<span class="sd">            - Lo1 : longitude of first grid point</span>
<span class="sd">            - LaD : latitude  where Dx and Dy are specified [deg]. \</span>
<span class="sd">                    LaD must be 60 (nps) or -60 (sps) (library limitation).</span>
<span class="sd">            - LoV : longitude where y axis is parallel to meridian.</span>
<span class="sd">            - LaO : latitude of projection origin, either 90 (nps) or -90 (sps)</span>
<span class="sd">            - Nx : number of points along the x-axis</span>
<span class="sd">            - Ny : number of points along the y-axis</span>
<span class="sd">            - Dx : x-direction grid length [m]</span>
<span class="sd">            - Dy : y-direction  grid length [m]</span>

<span class="sd">        - lambert_conformal_conic:</span>

<span class="sd">            - La1 : latitude of first grid point</span>
<span class="sd">            - Lo1 : longitude of first grid point</span>
<span class="sd">            - LaD : latitude  where Dx and Dy are specified [deg]</span>
<span class="sd">            - LoV : longitude where y axis is parallel to meridian</span>
<span class="sd">            - Latin1 : first latitude from pole which cuts the secant cone</span>
<span class="sd">            - Latin2 : second latitude from pole which cuts the secant cone</span>
<span class="sd">            - Nx : number of points along the x-axis</span>
<span class="sd">            - Ny : number of points along the y-axis</span>
<span class="sd">            - Dx : x-direction grid length [m]</span>
<span class="sd">            - Dy : y-direction  grid length [m]</span>

<span class="sd">        - gaussian :</span>
<span class="sd">            - lat0, lon0 : degrees of lat/lon for 1st grid point \</span>
<span class="sd">                ``lon1 = -lon0``, ``lat1 = lat0 + (nx-1)*dlon``</span>
<span class="sd">            - nx : number of grid points in X direction.</span>
<span class="sd">            - ny : number of grid points in Y direction. `ny` must be even.</span>
<span class="sd">            - dlon : degrees of longitude between adjacent grid points.</span>

<span class="sd">        - space_view :</span>

<span class="sd">            - Lap : latitude of sub-satellite point</span>
<span class="sd">            - Lop : longitude of sub-satellite point</span>
<span class="sd">            - Nx : number of points along the x-axis</span>
<span class="sd">            - Ny : number of points along the y-axis</span>
<span class="sd">            - Dx : apparent diameter of Earth in grid lengths, in x-direction</span>
<span class="sd">            - Dy : apparent diameter of Earth in grid lengths, in y-direction</span>
<span class="sd">            - Xp : x-coordinate of sub-satellite point</span>
<span class="sd">            - Yp : y-coordinate of sub-satellite point</span>
<span class="sd">            - Nr : altitude of the camera from the Earth&#39;s centre, measured in units of the Earth&#39;s (equatorial) radius</span>
<span class="sd">            - Xo : x-coordinate of origin of sector image</span>
<span class="sd">            - Yo : y-coordinate of origin of sector image</span>

<span class="sd">        - unstructured :</span>

<span class="sd">            - Npts : number of points.</span>

<span class="sd">        The following parameter is common for all projections :</span>

<span class="sd">            - winds : {&#39;grid&#39;, &#39;earth&#39;}, optional. Vector orientation. Default is &#39;earth&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Grid</span>
<span class="sd">        Projection specific class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;latitude_longitude&quot;</span><span class="p">:</span> <span class="n">GridLatLon</span><span class="p">,</span>
        <span class="s2">&quot;rotated_latitude_longitude&quot;</span><span class="p">:</span> <span class="n">GridRotLatLon</span><span class="p">,</span>
        <span class="s2">&quot;mercator&quot;</span><span class="p">:</span> <span class="n">GridMercator</span><span class="p">,</span>
        <span class="s2">&quot;polar_stereographic&quot;</span><span class="p">:</span> <span class="n">GridPolarStereo</span><span class="p">,</span>
        <span class="s2">&quot;lambert_conformal&quot;</span><span class="p">:</span> <span class="n">GridLambertConformal</span><span class="p">,</span>
        <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span> <span class="n">GridGaussian</span><span class="p">,</span>
        <span class="s2">&quot;space_view&quot;</span><span class="p">:</span> <span class="n">GridSpaceView</span><span class="p">,</span>
    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">projname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid or unsupported projection: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">projname</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">NCEP_GRIDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;latlon 0:144:2.5 90:73:-2.5&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;latlon 0:360:1 90:181:-1&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;latlon 0:720:0.5 90:361:-0.5&quot;</span><span class="p">,</span>
    <span class="mi">45</span><span class="p">:</span> <span class="s2">&quot;latlon 0:288:1.25 90:145:-1.25&quot;</span><span class="p">,</span>
    <span class="mi">98</span><span class="p">:</span> <span class="s2">&quot;gaussian 0:192:1.875 88.5419501372975:94&quot;</span><span class="p">,</span>
    <span class="mi">126</span><span class="p">:</span> <span class="s2">&quot;gaussian 0:384:0.9375 89.2767128781058:190&quot;</span><span class="p">,</span>
    <span class="mi">127</span><span class="p">:</span> <span class="s2">&quot;gaussian 0:768:0.46875 89.6416480725934:384&quot;</span><span class="p">,</span>
    <span class="mi">128</span><span class="p">:</span> <span class="s2">&quot;gaussian 0:1152:0.3125 89.7609950778017:576&quot;</span><span class="p">,</span>
    <span class="mi">129</span><span class="p">:</span> <span class="s2">&quot;gaussian 0:1760:0.20454545454545 89.8435135178685:880&quot;</span><span class="p">,</span>
    <span class="mi">170</span><span class="p">:</span> <span class="s2">&quot;gaussian 0:512:0.703125 89.4628215685774:256&quot;</span><span class="p">,</span>
    <span class="mi">173</span><span class="p">:</span> <span class="s2">&quot;latlon 0.041666667:4320:0.083333333 89.95833333:2160:-0.083333333&quot;</span><span class="p">,</span>
    <span class="mi">184</span><span class="p">:</span> <span class="s2">&quot;lambert:265:25 238.446:2145:2540 20.192:1377:2540&quot;</span><span class="p">,</span>
    <span class="mi">194</span><span class="p">:</span> <span class="s2">&quot;mercator:20 284.5:544:2500:297.491 15:310:2500:22.005&quot;</span><span class="p">,</span>
    <span class="mi">221</span><span class="p">:</span> <span class="s2">&quot;lambert:253:50 214.5:349:32463.41 1:277:32463.41&quot;</span><span class="p">,</span>
    <span class="mi">230</span><span class="p">:</span> <span class="s2">&quot;latlon 0:720:0.5 90:361:-0.5&quot;</span><span class="p">,</span>
    <span class="mi">242</span><span class="p">:</span> <span class="s2">&quot;nps:225:60 187:553:11250 30:425:11250&quot;</span><span class="p">,</span>
    <span class="mi">249</span><span class="p">:</span> <span class="s2">&quot;nps:210.0:60.0 188.4:367:9867.89 45.4:343:9867.89&quot;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="grid_fromstring"><a class="viewcode-back" href="../../generated/pywgrib2_xr.grid_fromstring.html#pywgrib2_xr.grid_fromstring">[docs]</a><span class="k">def</span> <span class="nf">grid_fromstring</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">winds</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory method to create projection from `wgrib2` style string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string: str</span>
<span class="sd">        Grid description in</span>
<span class="sd">        `wgrib2 style &lt;https://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/new_grid.html&gt;`_:</span>

<span class="sd">        - latitude longitude : &#39;latlon lon0:nlon:dlon lat0:nlat:dlat&#39;, where</span>

<span class="sd">            - lon0, lat0 : degrees of lat/lon for 1st grid point.</span>
<span class="sd">            - nlon : number of longitudes.</span>
<span class="sd">            - nlat : number of latitudes.</span>
<span class="sd">            - dlon : grid cell size in degrees of longitude.</span>
<span class="sd">            - dlat : grid cell size in degrees of latitude.</span>

<span class="sd">        - rotated latitude longitude : &#39;rot-ll:sp_lon:sp_lat:sp_rot lon0:nlon:dlon lat0:nlat:dlat&#39;, where</span>

<span class="sd">            - sp_lon : longitude of the South pole (for rotation)</span>
<span class="sd">            - sp_lat : latitude of the South pole (for rotation)</span>
<span class="sd">            - sp_rot : angle of rotation</span>
<span class="sd">            - lon0, lat0 : degrees of lat/lon for 1st grid point.</span>
<span class="sd">            - nlon : number of longitudes.</span>
<span class="sd">            - nlat : number of latitudes.</span>
<span class="sd">            - dlon : grid cell size in degrees of longitude.</span>
<span class="sd">            - dlat : grid cell size in degrees of latitude.</span>

<span class="sd">        - Mercator : &#39;mercator:lad lon0:nx:dx:lonn lat0:ny:dy:latn&#39;, where</span>

<span class="sd">            - lad : latitude (degrees) where dx and dy are specified.</span>
<span class="sd">            - lat0, lon0 : degrees of lat/lon for 1st grid point.</span>
<span class="sd">            - latn, lonn : degrees of lat/lon for last grid point.</span>
<span class="sd">            - nx : number of grid points in X direction.</span>
<span class="sd">            - ny : number of grid points in Y direction.</span>
<span class="sd">            - dx : grid cell distance in meters in x direction at lad.</span>
<span class="sd">            - dy : grid cell distance in meters in y direction at lad.</span>

<span class="sd">        - north polar stereographic: &#39;nps:lov:lad lon0:nx:dx lat0:ny:dy&#39;</span>
<span class="sd">        - south polar stereographic: &#39;sps:lov:lad lon0:nx:dx lat0:ny:dy&#39;</span>

<span class="sd">            - lov : longitude (degrees) where y axis is parallel to meridian.</span>
<span class="sd">            - lad : latitude (degrees) where dx and dy are specified. \</span>
<span class="sd">                    lad must be 60 (nps) or -60 (sps) (library limitation).</span>
<span class="sd">            - lat0, lon0 : degrees of lat/lon for 1st grid point.</span>
<span class="sd">            - nx : number of grid points in X direction.</span>
<span class="sd">            - ny : number of grid points in Y direction.</span>
<span class="sd">            - dx : grid cell distance meters in x direction at lad.</span>
<span class="sd">            - dy : grid cell distance meters in y direction at lad.</span>

<span class="sd">        - Lambert conformal : &#39;lambert:lov:latin1:latin2:lad lon0:nx:dx lat0:ny:dy&#39;</span>

<span class="sd">            - lov : longitude (degrees) where y axis is parallel to meridian</span>
<span class="sd">            - latin1 : first latitude from pole which cuts the secant cone</span>
<span class="sd">            - latin2 : second latitude from pole which cuts the secant cone</span>
<span class="sd">            - lad : latitude (degrees) where dx and dy are specified</span>
<span class="sd">            - lat0, lon0 : degrees of lat/lon for first grid point</span>
<span class="sd">            - nx : number of grid points in X direction</span>
<span class="sd">            - ny : number of grid points in Y direction</span>
<span class="sd">            - dx : grid cell size in meters in x direction</span>
<span class="sd">            - dy : grid cell size in meters in y direction</span>

<span class="sd">        - global Gaussian: &#39;gaussian lon0:nx:dlon lat0:ny&#39;</span>

<span class="sd">            lat0, lon0 : degrees of lat/lon for 1st grid point \</span>
<span class="sd">                ``(lon1 = -lon0``, ``lat1 = lat0 + (nx-1)*dlon)``</span>

<span class="sd">            nx : number of grid points in X direction.</span>

<span class="sd">            ny : number of grid points in Y direction. `ny` must be even.</span>

<span class="sd">            dlon : degrees of longitude between adjacent grid points.</span>

<span class="sd">    winds : {&#39;grid&#39;, &#39;earth&#39;}</span>
<span class="sd">        Vector orientation. Default is &#39;grid&#39;.</span>
<span class="sd">    globe: dict, optional</span>
<span class="sd">        Mapping: code -&gt; int, &#39;shape&#39; -&gt; str, &#39;earth_radius&#39; -&gt; float,</span>
<span class="sd">        &#39;semi_major_axis&#39; -&gt; float, &#39;semi_minor_axis&#39; -&gt; float</span>
<span class="sd">        Default is current NCEP choice: Earth assumed spherical with</span>
<span class="sd">        radius = 6,371,229.0 m.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Grid</span>
<span class="sd">        Projection specific class instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid grid description: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ncep&quot;</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span><span class="p">:</span>
        <span class="c1"># Predefined grids known to wgrib2</span>
        <span class="n">gridnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">NCEP_GRIDS</span><span class="p">[</span><span class="n">gridnum</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported NCEP grid: </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridnum</span><span class="p">))</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">projname</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;latlon&quot;</span><span class="p">:</span> <span class="n">GridLatLon</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
        <span class="s2">&quot;rot-ll&quot;</span><span class="p">:</span> <span class="n">GridRotLatLon</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
        <span class="s2">&quot;mercator&quot;</span><span class="p">:</span> <span class="n">GridMercator</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
        <span class="s2">&quot;nps&quot;</span><span class="p">:</span> <span class="n">GridPolarStereo</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
        <span class="s2">&quot;sps&quot;</span><span class="p">:</span> <span class="n">GridPolarStereo</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
        <span class="s2">&quot;lambert&quot;</span><span class="p">:</span> <span class="n">GridLambertConformal</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
        <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span> <span class="n">GridGaussian</span><span class="o">.</span><span class="n">fromstring</span><span class="p">,</span>
    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">projname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid or unsupported projection: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">projname</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">winds</span><span class="o">=</span><span class="n">winds</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019-2020, wgrib2 developers
      <span class="lastupdated">
        Last updated on 2020-12-18.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>